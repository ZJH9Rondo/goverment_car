<template>
    <div class="wrap" @appear="appeared" @disappear="disappeared">
        <div ref="anim" class="anim">
            <slot></slot>
        </div>
    </div>
</template>

<style scoped>
.wrap {
    overflow: hidden;
    position: relative;
}

.anim {
    flex-direction: column;
    position: absolute;
    transform: translateY(0) translateZ(0);
}
</style>

<script>            
var $animation = weex.requireModule('animation');
module.exports = {
    props: {
        step: {
            default: 0
        },
        count: {
            default: 0
        },
        index: {
            default: 1
        },
        duration: {
            default: 0
        },
        interval: {
            default: 0
        },
        outofview: {
            default: false
        }
    },
    mounted: function () {
        if (this.interval > 0 && this.step > 0 && this.duration > 0) {
            this.nextTick();
        }
    },
    methods: {
        nextTick: function () {
            var self = this;
            if (this.outofview) {
                setTimeout(self.nextTick.bind(self), self.interval);
            } else {
                setTimeout(function () {
                    self.animation(self.nextTick.bind(self));
                }, self.interval);
            }
        },
        animation: function (cb) {
            var self = this;
            var offset = -self.step * self.index;
            $animation.transition(this.$refs['anim'], {
                styles: {
                    transform: 'translateY(' + String(offset) + 'px) translateZ(0)'
                },
                timingFunction: 'ease',
                duration: self.duration
            }, function () {
                self.index = (self.index + 1) % self.count;
                self.$emit('change', {
                    index: self.index,
                    count: self.count
                });
                cb && cb();
            });
        },
        appeared: function () {
            this.outofview = false;
        },
        disappeared: function () {
            this.outofview = true;
        }
    }
};</script>

